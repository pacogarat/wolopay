<div ng-controller="ConfiguratorSelectItemController" >

    <form class="form-horizontal validation" name="form_items_global" novalidate ng-submit="next()" novalidate>
        <fieldset>
            <legend>
                {[{ 'configurator.step3.title' | translate }]}
                <wizard-next-button form-name="form_items_global" invalid="configuratorCurrent.items.length < 1"></wizard-next-button>
            </legend>
            <p class="newlines">{[{ 'configurator.step3.desc' | translate }]}</p>
            <div>

                <div class="row" style="margin-top: 40px">
                    <div class="col-md-10 col-md-offset-1" >
                        <h3>{[{ 'configurator.step3.item_tabs.title' | translate }]}</h3>
                        <div style="margin-bottom: 15px" class="ng-binding">{[{ 'configurator.step3.item_tabs.desc' | translate }]}</div>

                        <table class="table" style="margin-top: 20px" >
                            <thead>
                            <tr>
                                <td></td>
                                <td></td>
                                <td>{[{ 'configurator.step3.item_tabs.col_name' | translate }]}</td>
                                <td>{[{ 'configurator.step3.item_tabs.col_title' | translate }]}</td>
                                <td>{[{ 'configurator.step3.item_tabs.col_tooltip' | translate }]}</td>
                                <td>{[{ 'configurator.step3.item_tabs.col_image' | translate }]}</td>
                                <td></td>
                                <td></td>
                            </tr>
                            </thead>

                            <tbody ui-sortable="sortableOptions" ng-model="itemTabs">
                                <tr ng-repeat="itemTab in itemTabs" >
                                    <td class="move" style="cursor: move">
                                        <span class="glyphicon glyphicon-move" aria-hidden="true"></span>
                                    </td>
                                    <td>
                                        <a popover-placement="top" class="btn btn-default btn-sm" popover="Id: {[{ itemTab.name_unique }]}" ng-if="itemTab.name_unique">
                                            <span class="glyphicon glyphicon-hdd" aria-hidden="true"></span>
                                        </a>
                                    </td>
                                    <td>


                                        <input ng-model="itemTab.name" class="form-control">
                                        <div ng-show="!validateIsUniqueName(itemTab)" role="alert" style="margin-top: 10px" class="alert alert-danger">
                                            <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
                                            <span class="sr-only">Error:</span>
                                            {[{ 'configurator.step3.item_tabs.item_tab_cant_use_same_name' | translate }]}
                                        </div>



                                    </td>
                                    <td style="text-align: center">
                                        <div class="btn-group">
                                            <a label-edit class="btn btn-default" label="itemTab.name_label" languages="languages">
                                                <span class="glyphicon glyphicon-edit" aria-hidden="true"></span>
                                            </a>
                                            <a class="btn btn-default" ng-click="itemTab.name_label = null" ng-if="itemTab.name_label.translation_en">
                                                <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                                            </a>
                                        </div>
                                    </td>
                                    <td style="text-align: center">
                                        <div class="btn-group">
                                            <a label-edit ckeditor-availble="true"  class="btn btn-default" label="itemTab.description_label" languages="languages">
                                                <span class="glyphicon glyphicon-edit" aria-hidden="true"></span>
                                            </a>
                                            <a class="btn btn-default" ng-click="itemTab.description_label = null" ng-if="itemTab.description_label.translation_en">
                                                <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                                            </a>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="btn-group">
                                            <a class="btn btn-default" ng-click="uploadImage(itemTab)">
                                                <span class="glyphicon glyphicon-edit" aria-hidden="true"></span>
                                            </a>
                                            <a class="btn btn-default" ng-click="deleteImage(itemTab)" ng-if="itemTab.image.img">
                                                <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                                            </a>
                                        </div>
                                    </td>
                                    <td><img src="/img/1x1.png" ng-src="{[{ itemTab.image.img }]}" ng-if="itemTab.image.img" style="max-height: 35px"></td>
                                    <td>
                                        <a class="btn btn-default ng-scope" ng-click="removeItemTab(itemTab)">
                                            <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                                        </a>
                                    </td>
                                </tr>
                            </tbody>
                            <tr>
                                <td colspan="9" style="padding-top: 20px" >
                                    <button type="button" class="btn btn-default" aria-label="Left Align" ng-click="addItemTab()" ng-if="itemTabs.length < 10">
                                        <span class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span>
                                        {[{ 'configurator.step3.item_tabs.add_item_tab' | translate }]}
                                    </button>
                                </td>
                            </tr>

                        </table>
                    </div>
                </div>

                <div class="row" style="margin-top: 30px">
                    <div class="col-md-10 col-md-offset-1" >
                        <h3>{[{ 'configurator.step3.item.title' | translate }]}</h3>
                        <div style="margin-bottom: 15px" class="ng-binding">{[{ 'configurator.step3.item.desc' | translate }]}</div>
                        <table class="table" style="margin-top: 20px">
                            <thead>
                                <tr>
                                    <td colspan="100%">
                                        <input ng-model-options="{debounce: 100}" ng-model="searchText.$" placeholder="{[{ 'search' | translate }]}" class="form-control">
                                    </td>
                                </tr>
                                <tr>
                                    <!--<td>Item id</td>-->
                                    <td>{[{ 'configurator.step3.col_name' | translate }]}</td>
                                    <td>{[{ 'configurator.step3.col_unitary_price' | translate }]}</td>
                                    <td>{[{ 'configurator.step3.col_image' | translate }]}</td>
                                    <td>{[{ 'configurator.step3.col_special_type' | translate }]}</td>
                                    <td>{[{ 'configurator.step3.col_actions' | translate }]}</td>
                                </tr>
                            </thead>
                            <tr ng-repeat="item in configuratorCurrent.items | filter:searchText">
                                <!--<td>{[{ item.id }]}</td>-->
                                <td>{[{ item.name_label | api_translation | replace_our_vars }]}</td>
                                <td>
                                    <span ng-if="!item.special_type.id">{[{ item.unitary_price }]} {[{ item.unitary_price_country.currency.symbol }]}</span>
                                    <span ng-if="item.special_type.id">-</span>
                                </td>
                                <td><img src="/img/1x1.png" ng-src="{[{ item.image.img }]}" style="max-height: 60px"> </td>
                                <td>{[{ 'articles_special.' + (item.special_type.id || 'normal') | translate }]}</td>
                                <td>
                                    <div class="btn-group">
                                        <a ng-click="loadModal(item)"  class="btn btn-default">
                                            <span class="glyphicon glyphicon-edit" aria-hidden="true"></span>
                                        </a>
                                        <a data-dialog-confirmation data-callback="delete(item)" class="btn btn-default">
                                            <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                                        </a>
                                    </div>
                                </td>
                            </tr>

                        </table>


                        <!--MODAL WINDOW-->
                        <script type="text/ng-template" id="item_mod.html">
                            <form name="form_edit_item" class="validation" id="form_edit_item" role="form" action="{[{ '/admin/api/item/' + $root.app.id + (item.id ? '/' + item.id : '') }]}" ng-upload="uploadComplete(content)" enctype="multipart/form-data">
                                <div class="modal-header">
                                    <h3 class="modal-title">{[{ 'configurator.step3.form.title' | translate }]}</h3>
                                </div>
                                <div class="modal-body">
                                    <div class="form-group">
                                        <label>{[{ 'configurator.step3.form.name' | translate }]}</label>
                                        <div class="input-group" style="width: 100%" ng-repeat="language in languages">
                                            <span class="input-group-addon" style="width: 50px;">{[{ language.id | uppercase }]}</span>
                                            <input ng-required="language.id == 'en'" type="text" name="name_label_translation_{[{language.id}]}" ng-change="searchIfContainsNumber()" placeholder="{[{ 'configurator.step3.form.name_place_holder' | translate: {'number':'\{\[\{number\}\]\}'}  }]}" ng-model="item.name_label['translation_'+ language.id ]" class="form-control" >
                                        </div>
                                        <div class="alert alert-block alert-info" style="margin-top: 20px">
                                            <i class="fa-fw fa fa-info"></i> {[{ 'configurator.step3.form.replaced' | translate: {'number':'\{\[\{number\}\]\}'}  }]}
                                        </div>
                                        <div class="alert alert-block alert-warning" ng-if="not_number">
                                            <i class="fa-fw fa fa-info"></i> {[{ 'configurator.step3.form.replaced_empty' | translate: {'number':'\{\[\{number\}\]\}'}  }]}
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label>{[{ 'configurator.step3.form.short_description' | translate: {'number':'\{\[\{number\}\]\}'}  }]}</label>
                                        <div class="input-group" style="width: 100%" ng-repeat="language in languages">
                                            <span class="input-group-addon" style="width: 50px;">{[{ language.id | uppercase }]}</span>
                                            <input type="text" name="desc_short_label_translation_{[{language.id}]}" ng-model="item.description_short_label['translation_'+ language.id ]" class="form-control">
                                        </div>

                                        <div class="alert alert-block alert-info" style="margin-top: 20px">
                                            <i class="fa-fw fa fa-info"></i> {[{ 'configurator.step3.form.description_replaced' | translate : {'number':'\{\[\{number\}\]\}'} }]}
                                        </div>

                                    </div>

                                    <div class="form-group">
                                        <label>{[{ 'configurator.step3.form.description' | translate }]}</label>
                                        <div class="input-group" style="width: 100%" ng-repeat="language in languages">
                                            <span class="input-group-addon" style="width: 50px;">{[{ language.id | uppercase }]}</span>
                                            <input type="text" name="desc_label_translation_{[{language.id}]}" ng-model="item.description_label['translation_'+ language.id ]" class="form-control">
                                            <span class="input-group-btn"><button class="btn btn-default" data-label-edit-ck-editor data-translation-object="item.description_label" data-language="language" type="button"><span class="glyphicon glyphicon-edit"></span></button></span>
                                        </div>

                                        <div class="alert alert-block alert-info" style="margin-top: 20px">
                                            <i class="fa-fw fa fa-info"></i> {[{ 'configurator.step3.form.description_replaced' | translate: {'number':'\{\[\{number\}\]\}'}  }]}
                                        </div>

                                    </div>
                                    <div class="form-group">
                                        <label>{[{ 'configurator.step3.form.external_item_id' | translate: {'number':'\{\[\{number\}\]\}'}  }]}</label>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <input type="text" name="external_item_id" ng-model="item.external_item_id" maxlength="45" class="form-control">
                                            </div>
                                        </div>
                                        <div class="alert alert-block alert-info" style="margin-top: 20px">
                                            <i class="fa-fw fa fa-info"></i> {[{ 'configurator.step3.form.external_item_id_desc' | translate }]}
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label >{[{ 'configurator.step3.form.special_type' | translate }]}</label>
                                        <select name="special_type" ng-model="item.special_type.id" class="form-control" required style="width: 100%;">
                                            <option ng-repeat="type in ['normal', 'gacha_box'] track by $index" ng-selected="type==item.special_type.id" value="{[{type}]}"> {[{ ('articles_special.'+type) | translate }]} </option>
                                        </select>
                                        <input type="hidden" name="special_type" value="{[{ item.special_type.id }]}">
                                    </div>
                                    <div>
                                        <div class="form-group" >
                                            <label>{[{ 'configurator.step3.form.unitary_price' | translate: {'number':'\{\[\{number\}\]\}'}  }]}</label>
                                            <div class="row form-inline">

                                                <div class="col-xs-6" >
                                                    <select name="unitary_price_country" ng-model="item.unitary_price_country" class="form-control" required ng-options="country.name for country in countries track by country.id" style="width: 100%;">
                                                    </select>
                                                </div>
                                                <div class="col-xs-6" ng-if="item.special_type.id == 'normal'">
                                                    <div class="input-group">
                                                        <input type="number" name="unitary_price" ng-model="item.unitary_price" class="form-control" required step="any"  >
                                                        <span class="input-group-addon">{[{ item.unitary_price_country.currency.symbol }]} </span>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="alert alert-block alert-info" style="margin-top: 20px">
                                                <i class="fa-fw fa fa-info"></i> {[{ 'configurator.step3.form.unitary_price_desc' | translate }]}
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-group" >
                                        <label >{[{ 'configurator.step3.form.item_tabs' | translate }]}</label>
                                        <ui-select multiple ng-model="item.item_tabs" theme="select2" id="item_tabs_choice" style="display: block;">
                                            <ui-select-match>{[{$item.name}]}</ui-select-match>
                                            <ui-select-choices repeat="itemTab in itemTabs | filter: {$: $select.search}">
                                                {[{ itemTab.name }]}
                                            </ui-select-choices>
                                        </ui-select>
                                        <input type="hidden" name="item_tabs" value="{[{ item.item_tabs }]}">
                                    </div>
                                    <div class="form-group">
                                        <label>{[{ 'configurator.step3.form.image' | translate }]}</label>
                                        <div class="row">
                                            <div class="col-xs-6">
                                                <input type="file" name="file" class="form-control"  ng-model="item.image.img"  valid-file ng-required="!item.id" ng-class="{'ng-invalid-force': !item.id && !item.image.img}" accept="image/x-png, image/gif, image/jpeg" data-ng-change="modifiedImage=true">
                                                <em style="display: block;margin-top: 7px">{[{ 'configurator.step3.form.recommended' | translate }]}</em>
                                            </div>
                                            <div class="col-xs-6 text-center">
                                                <img ng-if="item.id && !modifiedImage" src="{[{item.image.img}]}">
                                            </div>
                                        </div>
                                    </div>

                                </div>
                                <div class="modal-footer">
                                    <button class="btn btn-primary" type="submit" data-click-once ng-disabled="form_edit_item.$invalid">{[{ 'ok' | translate }]}</button>
                                    <button class="btn btn-warning" type="button" ng-click="cancel()">{[{ 'cancel' | translate }]}</button>
                                </div>
                            </form>
                        </script>



                        <div style="margin-top: 20px">
                            <button type="button" class="btn btn-success btn-lg pull-right" ng-click="loadModal({})"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Add item</button>
                        </div>
                    </div>

                </div>
            </div>
        </fieldset>
    </form>
    <br><br>
</div>
<script type="text/ng-template" id="item_tab_image.html">
    <form name="form_edit_item" class="validation" id="form_edit_item2" role="form" method="post" action="{[{ '/admin/api/app/'+ $root.app.id +'/item_tab/photo/' + appTab.id}]}" ng-upload="uploadComplete(content)" enctype="multipart/form-data">
        <div class="modal-header">
            <h3 class="modal-title">{[{ 'configurator.step3.item_tabs.form.upload_photo' | translate }]}</h3>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>{[{ 'configurator.step3.item_tabs.form.image' | translate }]}</label>
                <input type="file" name="file" class="form-control"  ng-model="item.image.img"  valid-file ng-required="!item.id" ng-class="{'ng-invalid-force': !item.id && !item.image.img}" accept="image/x-png, image/gif, image/jpeg">
                <em style="display: block;margin-top: 7px">{[{ 'configurator.step3.item_tabs.form.recommended' | translate }]}</em>
            </div>

        </div>
        <div class="modal-footer">
            <button class="btn btn-primary" type="submit" data-click-once ng-disabled="form_edit_item.$invalid">{[{ 'ok' | translate }]}</button>
            <button class="btn btn-warning" type="button" ng-click="cancel()">{[{ 'cancel' | translate }]}</button>
        </div>
    </form>
</script>